# Домашнее задание по лекции №2

### Описание работы
1. Открыть консоль и зайти по ssh на ВМ
2. Открыть вторую консоль и также зайти по ssh на ту же ВМ (можно в докере 2 сеанса)
3. Запустить везде psql из под пользователя postgres
4. Сделать в первой сессии новую таблицу и наполнить ее данными
5. Посмотреть текущий уровень изоляции
6. Начать новую транзакцию в обеих сессиях с дефолтным (не меняя) уровнем изоляции
7. В первой сессии добавить новую запись
8. Сделать запрос на выбор всех записей во второй сессии
9. Видите ли вы новую запись и если да то почему? После задания можете сверить правильный ответ с эталонным (будет доступен после 3 лекции)
10. Завершить транзакцию в первом окне
11. Сделать запрос на выбор всех записей второй сессии
12. Видите ли вы новую запись и если да то почему?
13. Завершите транзакцию во второй сессии
14. Начать новые транзакции, но уже на уровне repeatable read в ОБЕИХ сессиях
15. В первой сессии добавить новую запись
16. Сделать запрос на выбор всех записей во второй сессии
17. Видите ли вы новую запись и если да то почему?
18. Завершить транзакцию в первом окне
19. Сделать запрос во выбор всех записей второй сессии
20. Видите ли вы новую запись и если да то почему?

### Ход работы
4. Для создания новой таблицы были выполнены команды ниже
```
thai=# CREATE TABLE users (
 id serial PRIMARY KEY,
 name text NOT NULL,
 created_on timestamptz
);

thai=# INSERT INTO users (name, created_on)
SELECT
    'Dylan',
    time_hour
FROM generate_series(
    TIMESTAMPTZ '2023-11-01',
    TIMESTAMPTZ '2023-11-07',
    INTERVAL '1 hour'
) as time_hour;
```

5. Текущий уровень изоляции найдем с помощью команды ниже
```
thai=# show transaction isolation level;
 transaction_isolation
-----------------------
 read committed
(1 row)
```

7. Добавим в первой сессии значение в таблицу командой ниже
```
thai=*# INSERT INTO users (name) VALUES ('IsolationTest7');
INSERT 0 1
``` 

9. Новая запись в таблице не отобразилась - ниже приведены последние значения в таблице
```
 140 | Dylan | 2023-11-06 19:00:00+03
 141 | Dylan | 2023-11-06 20:00:00+03
 142 | Dylan | 2023-11-06 21:00:00+03
 143 | Dylan | 2023-11-06 22:00:00+03
 144 | Dylan | 2023-11-06 23:00:00+03
 145 | Dylan | 2023-11-07 00:00:00+03
(145 rows)
```
Текущий уровень изоляции транзакций не допускает грязного чтения

12. После коммита транзакции в первой сессии, новая запись стала доступна во второй сессии
```
 140 | Dylan          | 2023-11-06 19:00:00+03
 141 | Dylan          | 2023-11-06 20:00:00+03
 142 | Dylan          | 2023-11-06 21:00:00+03
 143 | Dylan          | 2023-11-06 22:00:00+03
 144 | Dylan          | 2023-11-06 23:00:00+03
 145 | Dylan          | 2023-11-07 00:00:00+03
 146 | IsolationTest7 |
(146 rows)
```
Новую запись видно, так как на данном уровне изоляции транзакций возможно неповторяющееся чтение

14. Начинаем транзакции на уровне repeatable read
```
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
```

15. Добавим в первой сессии новую запись командой ниже
```
thai=*# INSERT INTO users (name) VALUES ('IsolationTest15');
INSERT 0 1
```

17. Во второй сессии запись не отображается, так как repeatable read не допускает грязного чтения

20. После коммита транзакции в первой сессии, новая запись так же не отображается в таблице в открытой транзакции второй сессии, так как указанный уровень изоляции также не допускает неповторяющегося чтения. Для того, чтобы новая запись стала доступна при выборке, необходимо завершить транзакцию во второй сессии - сделать коммит